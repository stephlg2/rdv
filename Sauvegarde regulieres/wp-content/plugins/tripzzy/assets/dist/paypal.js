(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(t,r,n){return(r=function(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,"string");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(r)?r:r+""}(r))in t?Object.defineProperty(t,r,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[r]=n,t}window.wp.i18n;var n=((function(e){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?t(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({},tripzzy.strings)||{}).messages||{}).required_field;function o(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t={validated:!0,message:null},r=!1,o=!1,i="",s=document.querySelectorAll("#tripzzy-checkout-form [required]");s.length>0&&s.forEach((function(t){var s=t.value.trim(),c=t.closest(".tripzzy-form-field").getAttribute("title");t.classList.remove("has-error"),s||(o=!0,i+=sprintf(n,c)+"</br />",e||(t.classList.add("has-error"),r||(r=!0,t.focus())))}));var c=document.querySelectorAll("#tripzzy-checkout-form input[type=email]");return c.length>0&&c.forEach((function(t){var n=t.value,s=t.closest(".tripzzy-form-field").getAttribute("title");t.classList.remove("has-error"),n&&!n.match(/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/)&&(o=!0,i+="* "+s+" is not valid. </br />",e||(t.classList.add("has-error"),r||(r=!0,t.focus())))})),o&&(t.validated=!1,t.message=i),t}function i(e){var t=document.getElementById("tripzzy-checkout-form-response-msg"),r=document.getElementById("tripzzy-checkout-form-response-title"),n=document.getElementById("tripzzy-checkout-form-response");e?(t.classList.add("tripzzy-response-msg","tripzzy-error"),r.innerHTML="Error",n.innerHTML=e):(t.classList.remove("tripzzy-response-msg","tripzzy-error"),r.innerHTML="",n.innerHTML="")}function s(){var e=document.getElementById("tripzzy-checkout-form-response-msg"),t=document.getElementById("tripzzy-checkout-form-response-title"),r=document.getElementById("tripzzy-checkout-form-response"),n=document.getElementById("tripzzy-payment-button");try{n.innerHTML="",n.classList.add("tripzzy-is-processing"),i();var s=document.getElementById("tripzzy-payment-details"),c=document.getElementById("tripzzy-checkout-form"),a=n.getAttribute("data-total");paypal.Buttons({onInit:function(e,t){t.disable(),o(!0).validated&&t.enable(),document.querySelectorAll("#tripzzy-checkout-form [required]").forEach((function(e){e.addEventListener("change",(function(e){var r=o();i(r.message),t.disable(),r.validated&&t.enable()}))}))},onClick:function(){i(o().message)},createOrder:function(e,t){return i(),t.order.create({purchase_units:[{amount:{value:null!=a?a:0},description:tripzzy.payment_description,payment_instruction:{soft_descriptor:"3D_SECURE",secure_payment:{required:!0}}}],application_context:{shipping_preference:"NO_SHIPPING"}})},onApprove:function(e,t){return t.order.capture().then((function(e){s.value=JSON.stringify(e),c.submit()}))},onCancel:function(n){e.classList.add("tripzzy-response-msg","tripzzy-error"),t.innerHTML="Cancelled",r.innerHTML="You have cancelled your payment."},onError:function(o){var i=o.message.match(/{[^]*}/)[0];if(i){var s=JSON.parse(i);e.classList.add("tripzzy-response-msg","tripzzy-error"),t.innerHTML=s.name,r.innerHTML=s.details[0].description}n.classList.remove("tripzzy-is-processing")}}).render("#tripzzy-payment-button").then((function(e){return n.classList.remove("tripzzy-is-processing")}))}catch(o){e.classList.add("tripzzy-response-msg","tripzzy-error"),t.innerHTML="Error",r.innerHTML=o.message,setTimeout((function(){n.classList.remove("tripzzy-is-processing")}),100)}}s(),document.addEventListener("click",(function(e){e.target===document.querySelector("#tripzzy-payment-mode-paypal_payment")&&s()}))})();